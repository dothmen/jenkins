package pages;

import java.io.FileOutputStream;
import java.io.IOException;

import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Workbook;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;
import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;

import stepsDefinition.Hooks;



public class ExtractionFiltrePage {

	WebDriver driver = Hooks.driver;

	public ExtractionFiltrePage(WebDriver driver) {
		this.driver = driver;
	}

	public void extractDataFromWebTable() {
		WebElement table = driver.findElement(By.xpath("//app-sessiondetails[1]//p-tabpanel[3]//p-table[1]//table[1]"));

		try (Workbook workbook = new XSSFWorkbook()) {
			Sheet sheet = workbook.createSheet("TableData");

			java.util.List<WebElement> rows = table.findElements(By.xpath(
					"/html[1]/body[1]/app-root[1]/app-admin[1]/app-sessiondetails[1]/div[1]/p-tabview[1]/div[1]/div[2]/p-tabpanel[3]/div[1]/p-table[1]/div[1]/div[2]/table[1]/thead[1]/tr[1]"));
			int rowNum = 0;

			for (WebElement row : rows) {
				Row excelRow = sheet.createRow(rowNum++);
				java.util.List<WebElement> cols = row.findElements(By.xpath(
						"//body[1]/app-root[1]/app-admin[1]/app-sessiondetails[1]/div[1]/p-tabview[1]/div[1]/div[2]/p-tabpanel[3]/div[1]/p-table[1]/div[1]/div[2]/table[1]/thead[1]/tr[1]/th[1]"));
				int colNum = 0;

				for (WebElement col : cols) {
					Cell cell = excelRow.createCell(colNum++);
					cell.setCellValue(col.getText());
				}
		 
				 
	            Cell EvaluationsCell = excelRow.getCell(3); 
	            if (colNum == 3 && EvaluationsCell.getStringCellValue().equals("(3 Votes)" )) {
					 EvaluationsCell.setCellValue("3");
	                }
	            if (colNum == 3 && EvaluationsCell.getStringCellValue().equals("(2 Votes)" )) {
					 EvaluationsCell.setCellValue("2");
	                }
	            
	            if (colNum == 3 && EvaluationsCell.getStringCellValue().equals("(1 Votes)" )) {
					 EvaluationsCell.setCellValue("1");
	                }
	            int Evaluations = Integer.parseInt(EvaluationsCell.getStringCellValue());  
	            if (Evaluations <= 3 ) {
	               
	                try (FileOutputStream outputStream = new FileOutputStream("FilteredTableData.xlsx")) {
	                    workbook.write(outputStream);
	                }
	            }
			}

			try (FileOutputStream outputStream = new FileOutputStream("TableData.xlsx")) {
				workbook.write(outputStream);
			}

		} catch (IOException e) {
			e.printStackTrace();
		}
	}

}